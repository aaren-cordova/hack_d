<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: widgets/WishlistItemView.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: widgets/WishlistItemView.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>goog.require('s6.widgets.IArtPieceModel');
goog.require('s6.widgets.ArtType');
goog.require('s6.widgets.ArtPieceModel.EventType');
goog.require('s6.widgets.WishlistStateType');
goog.require('goog.dom.DomHelper');
goog.require('goog.ui.Component');
goog.require('goog.asserts');
goog.require('goog.debug.Logger');
goog.require('goog.dom');

goog.provide('s6.widgets.WishlistItemView');
goog.scope(function(){
	var EventType = goog.events.EventType;
	var WishlistStateType = s6.widgets.WishlistStateType;

	var ArtPieceModel_EventType = s6.widgets.ArtPieceModel.EventType;
	var Logger = goog.debug.Logger;
	var Component = goog.ui.Component;

	/**
	 * @constructor
	 * @extends {goog.ui.Component}
	 * @param {goog.dom.DomHelper=} opt_domHelper Optional DOM helper.
	 */
	s6.widgets.WishlistItemView = function(opt_domHelper){
		Component.call(this, opt_domHelper);
	};
	goog.inherits(s6.widgets.WishlistItemView, Component);

	/**
	 * @param {s6.widgets.IArtPieceModel} artPieceModel
	 * @return {s6.widgets.WishlistItemView}
	 */
	s6.widgets.WishlistItemView.prototype.setArtPieceModel = function(artPieceModel){
		if(artPieceModel){
			goog.events.unlisten(artPieceModel, ArtPieceModel_EventType.FAVORITED_ENABLED, this.onFavoritedEnabledChanged_, false);
			goog.events.unlisten(artPieceModel, ArtPieceModel_EventType.ART_TYPE, this.onArtTypeChanged_, false, this);
			goog.events.unlisten(artPieceModel, ArtPieceModel_EventType.IMAGE_URL, this.onImageURLChanged_, false, this);
		}

		this.artPieceModel_ = artPieceModel;
		
		if(artPieceModel){
			goog.events.listen(artPieceModel, ArtPieceModel_EventType.FAVORITED_ENABLED, this.onFavoritedEnabledChanged_, false, this);
			goog.events.listen(artPieceModel, ArtPieceModel_EventType.ART_TYPE, this.onArtTypeChanged_, false, this);
			goog.events.listen(artPieceModel, ArtPieceModel_EventType.IMAGE_URL, this.onImageURLChanged_, false, this);
		}


		this.artPieceModel_ = artPieceModel;
		
		this.invalidate();
		return this;
	};

	/**
	 * @param {s6.widgets.IWishlistItemController} wishlistItemController
	 * @return {s6.widgets.WishlistItemView}
	 */
	s6.widgets.WishlistItemView.prototype.setWishlistItemController = function(wishlistItemController){
		this.wishlistItemController_ = wishlistItemController;
		return this;
	};

	/** @public */
	s6.widgets.WishlistItemView.prototype.invalidate = function(){
		this.onArtTypeChanged_(null);
		this.onImageURLChanged_(null);
	};

	

	/** @inheritDoc */
	s6.widgets.WishlistItemView.prototype.createDom = function(){

		var artPieceModel = this.artPieceModel_;
		var artJSON = artPieceModel.getPostJSON();
		var dom = this.dom_;
		// TODOL get id
		
		goog.events
		// TODOM
		var size = '45';
		var formAttributes = '1=' + size;
		var link = artJSON["link"].replace(/[\#\?].*/, '');
		var id = "11264507";

		var templateUrl = s6.global.image_url_template;

		var artViewRoot = dom.createDom("li", {"data-id":id, "data-url": link + "#" + formAttributes, 'class': 'wishlist-view-item-node'},
			this.artContainer = dom.createDom("div", {"class": "art-container", 'data-state': 'loading'},
				dom.createDom("form", {"id":"add_" + artJSON["post_id"], "data-type":"add", "method":"post", "action":"/shop/cart"},
					dom.createDom("input", {"type":"hidden", "name":"source", "value":"2"}),
					dom.createDom("input", {"type":"hidden", "name":"form_id", "value":"djWJAuNKvd9A5KN"}),
					dom.createDom("input", {"type":"hidden", "name":"post_id", "value":artJSON["post_id"]}),
					dom.createDom("input", {"type":"hidden", "name":"product_id", "value":artJSON["product_id"]}),
					dom.createDom("input", {"type":"hidden", "name":"quantity", "value":"1"}),
					dom.createDom("input", {"type":"hidden", "name":"form_attributes", "value":formAttributes}),
					dom.createDom("input", {"type":"hidden", "name":"form_js", "value":"0"}),
					dom.createDom("input", {"type":"hidden", "name":"form_preview", "value": artJSON["post_image"] + "-prn01"}),
					dom.createDom("input", {"type":"hidden", "name":"form_url", "value":link + "#" + formAttributes}),
					dom.createDom("input", {"type":"hidden", "name":"is_wishlist", "value":"false"}),
					dom.createDom("input", {"type":"hidden", "name":"attr_375914size", "value":size}),
					dom.createDom("input", {"type":"hidden", "name":"attr_375914custom", "value":"6x7.895"}),
					dom.createDom("input", {"type":"hidden", "name":"attr_375914details", "value":"W6-1b"}),
					//dom.createDom("noscript", {"&lt;input "type":"hidden", "name":"nojs", "value":"1" /&gt;&lt;/noscript}),
					this.artWorkImage = dom.createDom("img"),
					dom.createDom("button", {"class":"move", "type":"submit", "name":"add_item", "value":id}, "Move to Cart")
				),
				dom.createDom("form", {"id":"remove_375914", "data-type":"remove", "method":"post", "action":"/shop/cart"},
					dom.createDom("input", {"type":"hidden", "name":"is_wishlist", "value":"true"}),
					dom.createDom("input", {"type":"hidden", "name":"form_url", "value":"/prints"}),
					this.deleteButton = dom.createDom("button", {"class":"delete", "type":"submit", "name":"remove_item", "value":id}, "Ã—")
				),
				dom.createDom("a", {"class":"bg", "href":link + "#" + formAttributes}),
				dom.createDom("a", {"href":link + "#" + formAttributes}, artJSON["post_title"])
			)
		);

		this.decorateInternal(artViewRoot);
	};

	/** @private */
	s6.widgets.WishlistItemView.prototype.onImageURLChanged_ = function(event){
		var artPieceModel = this.artPieceModel_;
		var artContainer = this.artContainer;
		
		if(!artContainer){
			return;
		}

		if(!this.artWorkImage){
			jQuery(artContainer).attr('data-state', 'none');
		}
		else{
			jQuery(artContainer).attr('data-state', 'loading');
			
			jQuery(this.artWorkImage)
				.load(function(){
					jQuery(artContainer).attr('data-state', 'complete');
				})
				.attr('src', artPieceModel.getImageURL())
			;
		}
	};

	/** @inheritDoc */
	s6.widgets.WishlistItemView.prototype.decorateInternal = function(element){
		this.setElementInternal(element);
		this.addButtonListeners_();
		this.invalidate();
	};

	/** @private */
	s6.widgets.WishlistItemView.prototype.addButtonListeners_ = function (){
		goog.asserts.assert(this.wishlistItemController_, 'Controller required before rendering');

		var wishlistItemController = this.wishlistItemController_;
		if(this.artContainer){
			goog.events.listen(this.artContainer, EventType.MOUSEDOWN, wishlistItemController.onArtContainerClick, false, wishlistItemController);
		}
		if(this.toolContainer){
			goog.events.listen(this.toolContainer, EventType.MOUSEDOWN, wishlistItemController.onToolContainerClick, false, wishlistItemController);
		}

		if(this.deleteButton){
			goog.events.listen(this.deleteButton, EventType.MOUSEDOWN, wishlistItemController.onDeleteButtonClick, false, wishlistItemController);
		}
	};

	/** @private */
	s6.widgets.WishlistItemView.prototype.onNodeChanged_ = function(event){
		var node = this.artPieceModel_.getNode();

		jQuery(node).addClass('s6_widgets_art_piece_view_node')

		var parent = jQuery(node).parent()[0];
		this.render(parent);

		goog.dom.appendChild(this.artContainer, node);

		var imageWrap = jQuery(node).find('.image_wrap')[0];
		goog.dom.appendChild(imageWrap, this.toolContainer);
	};

	/** @private */
	s6.widgets.WishlistItemView.prototype.onArtTypeChanged_ = function(event){
		if(!this.getContentElement()){
			return;
		}

		var dataAttributeName = 'data-' + goog.string.toSelectorCase(ArtPieceModel_EventType.ART_TYPE);
		var dataAttributes = {};
		dataAttributes[dataAttributeName] = this.artPieceModel_.getArtType();
		
		goog.dom.setProperties(
			this.getContentElement(),
			dataAttributes
		);
	};

	/** @private */
	s6.widgets.WishlistItemView.prototype.onFavoritedEnabledChanged_ = function(event){
		if(!this.isDisposed()){
			this.dispose();
		}
	};
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="s6.Main.html">Main</a></li><li><a href="s6.widgets.ArtPieceController.html">ArtPieceController</a></li><li><a href="s6.widgets.ArtPieceModel.html">ArtPieceModel</a></li><li><a href="s6.widgets.ArtPieceView.html">ArtPieceView</a></li><li><a href="s6.widgets.WishlistController.html">WishlistController</a></li><li><a href="s6.widgets.WishlistItemController.html">WishlistItemController</a></li><li><a href="s6.widgets.WishlistItemView.html">WishlistItemView</a></li><li><a href="s6.widgets.WishlistModel.html">WishlistModel</a></li><li><a href="s6.widgets.WishlistView.html">WishlistView</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Mon Aug 18 2014 13:10:43 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
